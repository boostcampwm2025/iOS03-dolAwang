# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ (.env íŒŒì¼)
require 'dotenv'
Dotenv.load

skip_docs

default_platform(:ios)

platform :ios do
  desc "Development IPA build & AppBox internal distribution"
  lane :dev_appbox do |options|
    # envì—ì„œ ì´ë©”ì¼ ê°€ì ¸ì˜¤ê¸° (íŒŒë¼ë¯¸í„° -> í™˜ê²½ ë³€ìˆ˜ -> ê¸°ë³¸ê°’ ìˆœì„œì…ë‹ˆë‹¤.)
    emails = options[:emails] || ENV["APPBOX_EMAILS"] || "kayuaao96@gmail.com"
    
    build_app(
      scheme: "mirroringBooth",
      export_method: "development",
      output_directory: "./build",
      output_name: "mirroringBooth.ipa",
      clean: true
    )

    appbox(
      emails: emails,
      message: "MirroringBooth - ê°œë°œìš© ë¹Œë“œ {BUILD_VERSION}({BUILD_NUMBER}) ì¤€ë¹„ ì™„ë£Œ ğŸš€",
      keep_same_link: true
    )

    UI.success("âœ… ë¹Œë“œ ë° AppBox ì—…ë¡œë“œ ì™„ë£Œ")
    UI.message("ğŸ“¦ ì„¤ì¹˜ ë§í¬: #{lane_context[SharedValues::APPBOX_SHARE_URL]}")
  end

  desc "TestFlight build & upload"
  lane :dev_testflight do |options|
    
    build_app(
      scheme: "mirroringBooth",
      export_method: "app-store",
      output_directory: "./build",
      output_name: "mirroringBooth_appstore.ipa",
      clean: true
    )

    upload_to_testflight(
      skip_waiting_for_build_processing: true,
      apple_id: ENV["APPLE_ID"],
      team_id: ENV["TEAM_ID"],
      changelog: options[:changelog] || "ë²„ê·¸ ìˆ˜ì • ë° ì„±ëŠ¥ ê°œì„ "
    )

    UI.success("âœ… TestFlight ì—…ë¡œë“œ ì™„ë£Œ")
    UI.message("ğŸš€ App Store Connectì—ì„œ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤")
  end
end